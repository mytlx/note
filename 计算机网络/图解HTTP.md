# 第一章	Web及网络基础

* 客户端：通过发送请求获取服务器资源的Web浏览器等
* Web是建立在HTTP协议之上通信的
* 3项WWW构建技术
  * 把SGML（Standard Generalized Markup Language， 标准通用标记语言）作为页面的文本标记语言的HTML（HyperText Markup Language， 超文本标记语言）
  * 作为文档传递协议的HTTP
  * 自定文档所在地址的URL（Uniform Resource Locator， 统一资源定位符）



## 网络基础TCP/IP

通常使用的网络（包括互联网）是在TCP/IP协议族的基础上运行的，HTTP属于它内部的一个子集。

### TCP/IP协议族

* 协议（protocol）：不同的硬件、操作系统之间的通信，所有的这一切都需要一种规则，这种规则称为协议
* TCP/IP：与互联网相关联的协议集合

### TCP/IP的分层管理

* TCP/IP协议族按层次分为4层：应用层、传输层、网络层、数据链路层
  * 应用层
    * 决定了向用户提供应用服务时通信的活动
    * FTP、DNS、HTTP
  * 传输层
    * 对上层应用层，提供处于网络连接中的两台计算机之间的数据传输
    * TCP、UDP
  * 网络层（网络互连层）
    * 处理在网络上流动的数据包，数据包是网络传输的最小数据单位，该层规定了通过怎样的路径到达对方计算机，并把数据包传送给对方
    * 路由器、IP
  * 链路层（数据链路层、网络接口层）
    * 处理连接网络的硬件部分
    * 控制操作系统、硬件的设备驱动、NIC（Network Interface Card，网络适配器，网卡）、光纤等
* 分层的好处：
  * 如果互联网只由一个协议统筹，某个地方需要改动设计时，就必须把所有部分整体替换掉。而分层之后只需要把变动的层替换掉即可。把各层之间的接口部分规划好之后，每个层次内部的设计就能够自由改动了。
  * 设计变得相对简单了：
    * 处于应用层智商的应用可以只考虑分派给自己的任务，而不需要弄清对方在地球上哪个地方、对方的传输路线是怎样的、是否能确保传输送达等问题



## 与HTTP关系密切的协议：IP、TCP和DNS

### 负责传输的IP协议

IP（Internet Protocol， 网际协议）

* 网络层
* 把各种数据包传送给对方：需要IP地址和MAC地址
  * IP地址：指明节点被分配到的地址
    * 可更换
  * MAC地址：指网卡所属的固定地址
    * 基本上不会更改
  * ARP协议：用以解析地址的协议，根据IP地址可以查出MAC地址

### 确保可靠性的TCP协议

TCP（Transmission Control Protocol， 传输控制协议）

* 传输层
* 提供可靠的**字节流服务**
  * 字节流服务：为了方便传输，将大块数据分割成以**报文段（segment）**为单位的数据包进行管理
  * 可靠的传输服务：能够把数据准确可靠的传给对方
    * 三次握手
  * TCP协议为了更容易传送大数据才把数据分割，而且TCP协议能够确认数据最终是否送达到对方

### 负责域名解析的DNS服务

DNS（Domain Name System）

* 应用层
* 提供域名到IP地址之间的解析服务
  * 通过域名查找IP地址，或逆向从IP地址反查域名
  * 用户通常使用主机名或域名来访问计算机，而不是直接通过IP地址访问



## URI和URL

### URI：统一资源标识符

* URI：Uniform Resource Identifier
  * Uniform：规定统一的格式可方便处理多种不同类型的资源，而不用根据上文环境来识别资源指定的访问方式。
  * Resource：可识别的任何东西
    * 除了文档文件、图像或服务等能够区别于其他类型的，全都可以作为资源
    * 资源不仅可以是单一的，也可以是多数的集合体
  * Identifier：可标识的对象，也称标识符

* URI就是由某个协议方案标识的资源的定位标识符。

* 协议方案：访问资源所使用的协议类型名称

* URI用字符串标识某一互联网资源，而URL表示资源的地点
  * URL是URI的子集

### URI格式

表示指定的URI，要是用涵盖全部必要信息的**绝对URI**、**绝对URL**、**相对URL**

* 相对URL：从浏览器中基本URI处指定的URL

<h3 style="color:red;">// TODO：图片</h3>



# 第二章	简单的HTTP协议





## HTTP是不保存状态的协议

HTTP是一种不保存状态，即无状态（Stateless）协议

* 协议本身不保留之前一切的请求或响应报文的信息
* 为了更快的处理大量事务，确保协议的可伸缩性
* 为了实现保持状态功能，引入了Cookie技术



## 请求URI定位资源

HTTP协议使用URI定位互联网上的资源。

当客户端请求访问资源而发送请求时，URI需要将作为请求报文中的请求URI包含在内。

指定请求URI的方式：

* URI为完整的请求URI

  ```http
  GET http://hackr.jp/index.htm HTTP/1.1
  ```

* 在首部字段Host中写明网络域名或IP地址

  ```http
  GET /index.htm HTTP/1.1
  Host: hackr.jp
  ```

* 如果不是访问特定资源而是对服务器本身发起请求，可以用一个*来代替请求URI

  * 查询HTTP服务器端支持的HTTP方法种类

  ```http
  OPTIONS * HTTP/1.1
  ```



## 告知服务器意图的HTTP方法

下表列出了HTTP/1.0和HTTP/1.1支持的方法，方法名区分大小写。

| 方法             | 说明                   | 支持的HTTP协议版本 |
| ---------------- | ---------------------- | ------------------ |
| GET              | 获取资源               | 1.0、1.1           |
| POST             | 传输实体主体           | 1.0、1.1           |
| PUT              | 传输文件               | 1.0、1.1           |
| HEAD             | 获得报文首部           | 1.0、1.1           |
| DELETE           | 删除文件               | 1.0、1.1           |
| OPTIONS          | 询问支持的方法         | 1.1                |
| TRACE            | 追踪路径               | 1.1                |
| CONNECT          | 要求用隧道协议连接代理 | 1.1                |
| LINK（已废除）   | 建立和资源之间的联系   | 1.0                |
| UNLIKE（已废除） | 断开连接关系           | 1.0                |



## 持久连接节省通信量

HTTP协议的初始版本中，每进行一个HTTP通信就要断开TCP连接。

使用浏览器浏览一个包含多张图片的HTML页面时，在发送请求访问HTML页面资源的同时，也会请求该页面包含的其他资源，**每次请求都会造成无谓的TCP连接建立和断开，增加通信量的开销。**

为了解决上述问题，HTTP提出了**持久连接（HTTP Persistent Connections，也称HTTP keep-alive或HTTP connection resue）**

* 特点：只要任意一端没有明确提出断开连接，则保持TCP连接状态。
* 好处：
  * 减少了TCP连接的重复建立和断开所造成的额外开销，减轻了服务器端的负载
  * 减少开销的那部分时间，使HTTP请求和响应能够更早的结束，这也那个Web页面的显示速度也就提高了
* HTTP/1.1中，所有的连接默认都是持久化连接
* 使得**管线化（pipelining）**方式成为可能
  * 不用等待响应即可发送下一个请求
  * 可以同时并行发送多个请求



## 使用Cookie状态管理

Cookie技术通过在请求和响应报文中写入Cookie信息来控制客户端的状态。

Cookie会根据从服务器端发送的响应报文内的一个叫做Set-Cookie的首部字段信息，通知客户端保存Cookie。当下次客户端再往该服务器发送请求时，客户端会自动在请求报文中加入Cookie值后发送出去。

服务器端发现客户端发送过来的Cookie后，会去检查究竟是哪一个客户端发来的连接请求，然后对比服务器上的记录，最后得到之前的状态信息。



# 第三章	HTTP报文内的HTTP信息





## 编码提升传输速率

HTTP在传输数据时可以按照数据原貌直接传输，也可以在传输过程中通过编码提升传输速率。

通过在传输时编码，能有效处理大量的访问请求，但是编码的操作会消耗CPU等资源。

### 报文主体和实体主体的差异

* 报文（message）
  * 是HTTP通信中的基本单位，由8位组字节流组成
* 实体（entity）
  * 作为请求或响应的有效载荷数据被传输，其内容由实体首部和实体主体组成

HTTP报文的主体用于传输请求或响应的实体主体。

通常，报文主体等于实体主体。只有编码时，实体主体的内容发生变化，才导致和报文主体不一致。

### 压缩传输的内容编码

内容编码指明应用在实体内容上的编码格式，并保持实体信息原样压缩。

内容编码后的实体由客户端接受并负责解码。

常用的内容编码有以下几种：

* gzip（GNU zip）
* compress（UNIX系统的标准压缩）
* deflate（zlib）
* identity（不进行编码）

### 分割发送的分块传输编码

在HTTP通信中，请求的编码实体资源尚未全部传输完成之前，浏览器无法显示请求页面。

在传输大容量数据时，通过把数据分割成多块，能够让浏览器逐步显示页面。

分块传输编码（Chunked Transfer Coding）：这种把实体主体分块的功能。

* 将实体主体分成多个部分（块）
* 每块用十六进制来标记块的大小，最后一块用“0（CR+LF)”标记



# 第四章	返回结果的HTTP状态码

状态码的职责是当客户端向服务器端发送请求时，描述返回的请求结果。

借助状态码，用户可以知道服务器端是正常处理还是出现了错误。

* 状态码的类型：

| 状态码 | 类别                             | 原因短语                   |
| ------ | -------------------------------- | -------------------------- |
| 1XX    | Informational（信息性状态码）    | 接受的请求正在处理         |
| 2XX    | Success（成功状态码）            | 请求正常处理完毕           |
| 3XX    | Redirection（重定向状态码）      | 需要进行附加操作以完成请求 |
| 4XX    | Client Error（客户端错误状态码） | 服务器无法处理请求         |
| 5XX    | Server Error（服务器错误状态码） | 服务器处理请求出错         |



## 2XX成功

### 200 OK

表示从客户端发来的请求在服务器端被正常处理了。

### 204 No Content

表示服务器接受的请求已成功处理，但在返回的响应报文中不含实体的主体部分，也不允许返回任何实体的主体。

* 返回204响应，浏览器显示的页面不会发生更新
* 一般在只需要从客户端往服务器发送信息，而对客户端不需要发送信息内容的情况下使用

### 206 Partial Content

表示客户端进行了范围请求，而服务器成功执行了GET请求。

* 响应报文汇总包含由Content-Range指定范围的实体



## 3XX 重定向

3XX响应结果表明浏览器需要执行某些特殊的处理以正确处理请求。

### 301 Moved Permanently

**永久性重定向。**

* 表示请求的资源已被分配了新的URI，以后应使用资源现在所指的URI。
* 如果把资源对应的URI保存为书签了，应按照Location首部字段提示的URI重新保存。

### 302 Found

临时性重定向。

* 表示请求的资源已被分配了新的URI，希望用户（本次）能使用新的URI访问。

### 303 See Other

表示由于请求对应的资源存在着另一个URI，应使用GET方法定向获取请求的资源。

---

当301，302，303响应状态码返回时，几乎所有浏览器都会把POST改成GET，并删除请求报文内的主体，之后请求会自动再次发送。

301、302标准是禁止将POST方法改成GET方法的，但实际使用都会这么做。

---

### 304 Not Modified

表示客户端发送附带条件的请求时，服务器端允许请求访问资源，但未满足条件的情况。

* 返回时，不包含任何响应的主体部分
* 和重定向没有关系

### 307 Temporary Redirect

临时重定向。

* 307会遵照浏览器标准，不会从POST变成GET。



## 4XX客户端错误

4XX的响应结果表明客户端是发生错误的原因所在。

### 400 Bad Request

表示请求报文中存在语法错误。

* 需要修改请求的内容后再次发送
* 浏览器会像200 OK一样对待该状态

### 401 Unauthorized

表示发送的请求需要有通过HTTP认证（BASIC认证、DIGEST认证）的认证信息。

* 如果之前已进行过1次请求，则表示用户认证失败。

### 403 Forbidden

表示对请求资源的访问被服务器拒绝了。

* 服务器如果想说明，可以在实体的主体部分对原因进行描述
* 原因：未获得文件系统的访问授权，访问权限出现某些问题

### 404 Not Found

表示服务器上无法找到请求的资源。



## 5XX服务器错误

5XX表明服务器本身发生错误。

### 500 Internal Server Error

表示服务器端在执行请求时发生了错误，也有可能是Web应用存在的bug或某些临时的故障。

### 503 Service Unavailable

表示服务器暂时处于超负载或正在进行停机维护，现在无法处理请求。



---

**状态码和状况不一致**

不少返回的状态码响应都是错误的，但是用户可能察觉不到这点。

---



# 第五章	与HTTP协作的Web服务器



























